services:
  # ── App (Vite Dev Server) ──────────────────────
  app:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "5173:5173"
    volumes:
      - .:/app
      - /app/node_modules    # Evitar sobreescribir node_modules del container
    environment:
      - VITE_USE_FIREBASE_EMULATOR=true
      - VITE_FIREBASE_PROJECT_ID=demo-project
      - VITE_FIREBASE_DATABASE_URL=http://127.0.0.1:9000/?ns=demo-project-default-rtdb
      - VITE_FIREBASE_API_KEY=demo-api-key
      - VITE_FIREBASE_AUTH_DOMAIN=demo-project.firebaseapp.com
      - VITE_FIREBASE_STORAGE_BUCKET=demo-project.appspot.com
      - VITE_FIREBASE_MESSAGING_SENDER_ID=123456789
      - VITE_FIREBASE_APP_ID=1:123456789:web:abc123
    depends_on:
      firebase:
        condition: service_started

  # ── Firebase Emulators ─────────────────────────
  firebase:
    build:
      context: .
      dockerfile: Dockerfile.firebase
    ports:
      - "4000:4000"    # Emulator UI
      - "5002:5000"    # Hosting (5002 porque macOS usa 5000 para AirPlay)
      - "8080:8080"    # Firestore
      - "9000:9000"    # Realtime Database
      - "9099:9099"    # Auth
      - "9199:9199"    # Storage
    volumes:
      - firebase-data:/app/firebase-data

volumes:
  firebase-data:
